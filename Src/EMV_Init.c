/**
 * \file
 * \brief This module implements the EMV API functionalities related to the transaction initialisation
 * (Get Processing Options, Read Records, Offline Data Authentication and Processing Restriction).
 *
 * \author Ingenico
 * \author Copyright (c) 2012 Ingenico, 28-32, boulevard de Grenelle,\n
 * 75015 Paris, France, All Rights Reserved.
 *
 * \author Ingenico has intellectual property rights relating to the technology embodied\n
 * in this software. In particular, and without limitation, these intellectual property rights may\n
 * include one or more patents.\n
 * This software is distributed under licenses restricting its use, copying, distribution, and\n
 * and decompilation. No part of this software may be reproduced in any form by any means\n
 * without prior written authorisation of Ingenico.
 **/

/////////////////////////////////////////////////////////////////
//// Includes ///////////////////////////////////////////////////

#include "sdk.h"
#include "SEC_interface.h"
#include "GL_GraphicLib.h"
#include "TlvTree.h"
#include "GTL_Assert.h"

#include "EPSTOOL_Convert.h"
#include "EPSTOOL_TlvTree.h"
#include "EPSTOOL_PinEntry.h"

#include "EmvLib_Tags.h"
#include "EMV_Status.h"
#include "EMV_ApiTags.h"
#include "EMV_Api.h"

#include "EMV_UserInterfaceDisplay.h"
#include "EMV_ServicesEmv.h"
#include "EMV_ServicesEmv_FinalSelect.h"
#include "EMV_ServicesEmv_Init.h"
#include "globals.h"

//// Macros & preprocessor definitions //////////////////////////

//// Types //////////////////////////////////////////////////////

//// Static function definitions ////////////////////////////////

//// Global variables ///////////////////////////////////////////

////  variables ///////////////////////////////////////////

//// Functions //////////////////////////////////////////////////


//! \brief Called just after the READ RECORD commands.
//! \param[in] inputTlvTree Input TlvTree. Contains data from read records step.
//! \param[out] outputTlvTree Output TlvTree. Usually contains the CA Public Key and PAN related data (such as exception file indicator).
void EMV_ServicesEmv_StepReadApplicationData(TLV_TREE_NODE inputTlvTree, TLV_TREE_NODE outputTlvTree) {
	static const unsigned char inBlackList[2] = { 0x00, 0x00 };		// The PAN is not in the exception file
	static const unsigned char exponent[1] = { 0x03 };

	//// VISA
	static const unsigned char caPublicKey94[] = {
			0xAC, 0xD2, 0xB1, 0x23, 0x02, 0xEE, 0x64, 0x4F, 0x3F, 0x83, 0x5A, 0xBD, 0x1F, 0xC7, 0xA6, 0xF6,
			0x2C, 0xCE, 0x48, 0xFF, 0xEC, 0x62, 0x2A, 0xA8, 0xEF, 0x06, 0x2B, 0xEF, 0x6F, 0xB8, 0xBA, 0x8B,
			0xC6, 0x8B, 0xBF, 0x6A, 0xB5, 0x87, 0x0E, 0xED, 0x57, 0x9B, 0xC3, 0x97, 0x3E, 0x12, 0x13, 0x03,
			0xD3, 0x48, 0x41, 0xA7, 0x96, 0xD6, 0xDC, 0xBC, 0x41, 0xDB, 0xF9, 0xE5, 0x2C, 0x46, 0x09, 0x79,
			0x5C, 0x0C, 0xCF, 0x7E, 0xE8, 0x6F, 0xA1, 0xD5, 0xCB, 0x04, 0x10, 0x71, 0xED, 0x2C, 0x51, 0xD2,
			0x20, 0x2F, 0x63, 0xF1, 0x15, 0x6C, 0x58, 0xA9, 0x2D, 0x38, 0xBC, 0x60, 0xBD, 0xF4, 0x24, 0xE1,
			0x77, 0x6E, 0x2B, 0xC9, 0x64, 0x80, 0x78, 0xA0, 0x3B, 0x36, 0xFB, 0x55, 0x43, 0x75, 0xFC, 0x53,
			0xD5, 0x7C, 0x73, 0xF5, 0x16, 0x0E, 0xA5, 0x9F, 0x3A, 0xFC, 0x53, 0x98, 0xEC, 0x7B, 0x67, 0x75,
			0x8D, 0x65, 0xC9, 0xBF, 0xF7, 0x82, 0x8B, 0x6B, 0x82, 0xD4, 0xBE, 0x12, 0x4A, 0x41, 0x6A, 0xB7,
			0x30, 0x19, 0x14, 0x31, 0x1E, 0xA4, 0x62, 0xC1, 0x9F, 0x77, 0x1F, 0x31, 0xB3, 0xB5, 0x73, 0x36,
			0x00, 0x0D, 0xFF, 0x73, 0x2D, 0x3B, 0x83, 0xDE, 0x07, 0x05, 0x2D, 0x73, 0x03, 0x54, 0xD2, 0x97,
			0xBE, 0xC7, 0x28, 0x71, 0xDC, 0xCF, 0x0E, 0x19, 0x3F, 0x17, 0x1A, 0xBA, 0x27, 0xEE, 0x46, 0x4C,
			0x6A, 0x97, 0x69, 0x09, 0x43, 0xD5, 0x9B, 0xDA, 0xBB, 0x2A, 0x27, 0xEB, 0x71, 0xCE, 0xEB, 0xDA,
			0xFA, 0x11, 0x76, 0x04, 0x64, 0x78, 0xFD, 0x62, 0xFE, 0xC4, 0x52, 0xD5, 0xCA, 0x39, 0x32, 0x96,
			0x53, 0x0A, 0xA3, 0xF4, 0x19, 0x27, 0xAD, 0xFE, 0x43, 0x4A, 0x2D, 0xF2, 0xAE, 0x30, 0x54, 0xF8,
			0x84, 0x06, 0x57, 0xA2, 0x6E, 0x0F, 0xC6, 0x17};

	static const unsigned char caPublicKey05[] = {
			0xD0, 0x13, 0x5C, 0xE8, 0xA4, 0x43, 0x6C, 0x7F, 0x9D, 0x5C, 0xC6, 0x65, 0x47, 0xE3, 0x0E, 0xA4,
			0x02, 0xF9, 0x81, 0x05, 0xB7, 0x17, 0x22, 0xE2, 0x4B, 0xC0, 0x8D, 0xCC, 0x80, 0xAB, 0x7E, 0x71,
			0xEC, 0x23, 0xB8, 0xCE, 0x6A, 0x1D, 0xC6, 0xAC, 0x2A, 0x8C, 0xF5, 0x55, 0x43, 0xD7, 0x4A, 0x8A,
			0xE7, 0xB3, 0x88, 0xF9, 0xB1, 0x74, 0xB7, 0xF0, 0xD7, 0x56, 0xC2, 0x2C, 0xBB, 0x59, 0x74, 0xF9,
			0x01, 0x6A, 0x56, 0xB6, 0x01, 0xCC, 0xA6, 0x4C, 0x71, 0xF0, 0x4B, 0x78, 0xE8, 0x6C, 0x50, 0x1B,
			0x19, 0x3A, 0x55, 0x56, 0xD5, 0x38, 0x9E, 0xCE, 0x4D, 0xEA, 0x25, 0x8A, 0xB9, 0x7F, 0x52, 0xA3};

	static const unsigned char caPublicKey07[] = {
			0xA8, 0x9F, 0x25, 0xA5, 0x6F, 0xA6, 0xDA, 0x25, 0x8C, 0x8C, 0xA8, 0xB4, 0x04, 0x27, 0xD9, 0x27,
			0xB4, 0xA1, 0xEB, 0x4D, 0x7E, 0xA3, 0x26, 0xBB, 0xB1, 0x2F, 0x97, 0xDE, 0xD7, 0x0A, 0xE5, 0xE4,
			0x48, 0x0F, 0xC9, 0xC5, 0xE8, 0xA9, 0x72, 0x17, 0x71, 0x10, 0xA1, 0xCC, 0x31, 0x8D, 0x06, 0xD2,
			0xF8, 0xF5, 0xC4, 0x84, 0x4A, 0xC5, 0xFA, 0x79, 0xA4, 0xDC, 0x47, 0x0B, 0xB1, 0x1E, 0xD6, 0x35,
			0x69, 0x9C, 0x17, 0x08, 0x1B, 0x90, 0xF1, 0xB9, 0x84, 0xF1, 0x2E, 0x92, 0xC1, 0xC5, 0x29, 0x27,
			0x6D, 0x8A, 0xF8, 0xEC, 0x7F, 0x28, 0x49, 0x20, 0x97, 0xD8, 0xCD, 0x5B, 0xEC, 0xEA, 0x16, 0xFE,
			0x40, 0x88, 0xF6, 0xCF, 0xAB, 0x4A, 0x1B, 0x42, 0x32, 0x8A, 0x1B, 0x99, 0x6F, 0x92, 0x78, 0xB0,
			0xB7, 0xE3, 0x31, 0x1C, 0xA5, 0xEF, 0x85, 0x6C, 0x2F, 0x88, 0x84, 0x74, 0xB8, 0x36, 0x12, 0xA8,
			0x2E, 0x4E, 0x00, 0xD0, 0xCD, 0x40, 0x69, 0xA6, 0x78, 0x31, 0x40, 0x43, 0x3D, 0x50, 0x72, 0x5F };

	static const unsigned char caPublicKey08[] = {
			0xD9, 0xFD, 0x6E, 0xD7, 0x5D, 0x51, 0xD0, 0xE3, 0x06, 0x64, 0xBD, 0x15, 0x70, 0x23, 0xEA, 0xA1,
			0xFF, 0xA8, 0x71, 0xE4, 0xDA, 0x65, 0x67, 0x2B, 0x86, 0x3D, 0x25, 0x5E, 0x81, 0xE1, 0x37, 0xA5,
			0x1D, 0xE4, 0xF7, 0x2B, 0xCC, 0x9E, 0x44, 0xAC, 0xE1, 0x21, 0x27, 0xF8, 0x7E, 0x26, 0x3D, 0x3A,
			0xF9, 0xDD, 0x9C, 0xF3, 0x5C, 0xA4, 0xA7, 0xB0, 0x1E, 0x90, 0x70, 0x00, 0xBA, 0x85, 0xD2, 0x49,
			0x54, 0xC2, 0xFC, 0xA3, 0x07, 0x48, 0x25, 0xDD, 0xD4, 0xC0, 0xC8, 0xF1, 0x86, 0xCB, 0x02, 0x0F,
			0x68, 0x3E, 0x02, 0xF2, 0xDE, 0xAD, 0x39, 0x69, 0x13, 0x3F, 0x06, 0xF7, 0x84, 0x51, 0x66, 0xAC,
			0xEB, 0x57, 0xCA, 0x0F, 0xC2, 0x60, 0x34, 0x45, 0x46, 0x98, 0x11, 0xD2, 0x93, 0xBF, 0xEF, 0xBA,
			0xFA, 0xB5, 0x76, 0x31, 0xB3, 0xDD, 0x91, 0xE7, 0x96, 0xBF, 0x85, 0x0A, 0x25, 0x01, 0x2F, 0x1A,
			0xE3, 0x8F, 0x05, 0xAA, 0x5C, 0x4D, 0x6D, 0x03, 0xB1, 0xDC, 0x2E, 0x56, 0x86, 0x12, 0x78, 0x59,
			0x38, 0xBB, 0xC9, 0xB3, 0xCD, 0x3A, 0x91, 0x0C, 0x1D, 0xA5, 0x5A, 0x5A, 0x92, 0x18, 0xAC, 0xE0,
			0xF7, 0xA2, 0x12, 0x87, 0x75, 0x26, 0x82, 0xF1, 0x58, 0x32, 0xA6, 0x78, 0xD6, 0xE1, 0xED, 0x0B};

	static const unsigned char caPublicKey09[] = {
			0x9D, 0x91, 0x22, 0x48, 0xDE, 0x0A, 0x4E, 0x39, 0xC1, 0xA7, 0xDD, 0xE3, 0xF6, 0xD2, 0x58, 0x89,
			0x92, 0xC1, 0xA4, 0x09, 0x5A, 0xFB, 0xD1, 0x82, 0x4D, 0x1B, 0xA7, 0x48, 0x47, 0xF2, 0xBC, 0x49,
			0x26, 0xD2, 0xEF, 0xD9, 0x04, 0xB4, 0xB5, 0x49, 0x54, 0xCD, 0x18, 0x9A, 0x54, 0xC5, 0xD1, 0x17,
			0x96, 0x54, 0xF8, 0xF9, 0xB0, 0xD2, 0xAB, 0x5F, 0x03, 0x57, 0xEB, 0x64, 0x2F, 0xED, 0xA9, 0x5D,
			0x39, 0x12, 0xC6, 0x57, 0x69, 0x45, 0xFA, 0xB8, 0x97, 0xE7, 0x06, 0x2C, 0xAA, 0x44, 0xA4, 0xAA,
			0x06, 0xB8, 0xFE, 0x6E, 0x3D, 0xBA, 0x18, 0xAF, 0x6A, 0xE3, 0x73, 0x8E, 0x30, 0x42, 0x9E, 0xE9,
			0xBE, 0x03, 0x42, 0x7C, 0x9D, 0x64, 0xF6, 0x95, 0xFA, 0x8C, 0xAB, 0x4B, 0xFE, 0x37, 0x68, 0x53,
			0xEA, 0x34, 0xAD, 0x1D, 0x76, 0xBF, 0xCA, 0xD1, 0x59, 0x08, 0xC0, 0x77, 0xFF, 0xE6, 0xDC, 0x55,
			0x21, 0xEC, 0xEF, 0x5D, 0x27, 0x8A, 0x96, 0xE2, 0x6F, 0x57, 0x35, 0x9F, 0xFA, 0xED, 0xA1, 0x94,
			0x34, 0xB9, 0x37, 0xF1, 0xAD, 0x99, 0x9D, 0xC5, 0xC4, 0x1E, 0xB1, 0x19, 0x35, 0xB4, 0x4C, 0x18,
			0x10, 0x0E, 0x85, 0x7F, 0x43, 0x1A, 0x4A, 0x5A, 0x6B, 0xB6, 0x51, 0x14, 0xF1, 0x74, 0xC2, 0xD7,
			0xB5, 0x9F, 0xDF, 0x23, 0x7D, 0x6B, 0xB1, 0xDD, 0x09, 0x16, 0xE6, 0x44, 0xD7, 0x09, 0xDE, 0xD5,
			0x64, 0x81, 0x47, 0x7C, 0x75, 0xD9, 0x5C, 0xDD, 0x68, 0x25, 0x46, 0x15, 0xF7, 0x74, 0x0E, 0xC0,
			0x7F, 0x33, 0x0A, 0xC5, 0xD6, 0x7B, 0xCD, 0x75, 0xBF, 0x23, 0xD2, 0x8A, 0x14, 0x08, 0x26, 0xC0,
			0x26, 0xDB, 0xDE, 0x97, 0x1A, 0x37, 0xCD, 0x3E, 0xF9, 0xB8, 0xDF, 0x64, 0x4A, 0xC3, 0x85, 0x01,
			0x05, 0x01, 0xEF, 0xC6, 0x50, 0x9D, 0x7A, 0x41};

	static const unsigned char caPublicKey95[] = {
			0xBE, 0x9E, 0x1F, 0xA5, 0xE9, 0xA8, 0x03, 0x85, 0x29, 0x99, 0xC4, 0xAB, 0x43, 0x2D, 0xB2, 0x86,
			0x00, 0xDC, 0xD9, 0xDA, 0xB7, 0x6D, 0xFA, 0xAA, 0x47, 0x35, 0x5A, 0x0F, 0xE3, 0x7B, 0x15, 0x08,
			0xAC, 0x6B, 0xF3, 0x88, 0x60, 0xD3, 0xC6, 0xC2, 0xE5, 0xB1, 0x2A, 0x3C, 0xAA, 0xF2, 0xA7, 0x00,
			0x5A, 0x72, 0x41, 0xEB, 0xAA, 0x77, 0x71, 0x11, 0x2C, 0x74, 0xCF, 0x9A, 0x06, 0x34, 0x65, 0x2F,
			0xBC, 0xA0, 0xE5, 0x98, 0x0C, 0x54, 0xA6, 0x47, 0x61, 0xEA, 0x10, 0x1A, 0x11, 0x4E, 0x0F, 0x0B,
			0x55, 0x72, 0xAD, 0xD5, 0x7D, 0x01, 0x0B, 0x7C, 0x9C, 0x88, 0x7E, 0x10, 0x4C, 0xA4, 0xEE, 0x12,
			0x72, 0xDA, 0x66, 0xD9, 0x97, 0xB9, 0xA9, 0x0B, 0x5A, 0x6D, 0x62, 0x4A, 0xB6, 0xC5, 0x7E, 0x73,
			0xC8, 0xF9, 0x19, 0x00, 0x0E, 0xB5, 0xF6, 0x84, 0x89, 0x8E, 0xF8, 0xC3, 0xDB, 0xEF, 0xB3, 0x30,
			0xC6, 0x26, 0x60, 0xBE, 0xD8, 0x8E, 0xA7, 0x8E, 0x90, 0x9A, 0xFF, 0x05, 0xF6, 0xDA, 0x62, 0x7B};

	static const unsigned char caPublicKey[]= {
			0x99, 0x6A, 0xF5, 0x6F, 0x56, 0x91, 0x87, 0xD0, 0x92, 0x93, 0xC1, 0x48, 0x10, 0x45, 0x0E, 0xD8,
			0xEE, 0x33, 0x57, 0x39, 0x7B, 0x18, 0xA2, 0x45, 0x8E, 0xFA, 0xA9, 0x2D, 0xA3, 0xB6, 0xDF, 0x65,
			0x14, 0xEC, 0x06, 0x01, 0x95, 0x31, 0x8F, 0xD4, 0x3B, 0xE9, 0xB8, 0xF0, 0xCC, 0x66, 0x9E, 0x3F,
			0x84, 0x40, 0x57, 0xCB, 0xDD, 0xF8, 0xBD, 0xA1, 0x91, 0xBB, 0x64, 0x47, 0x3B, 0xC8, 0xDC, 0x9A,
			0x73, 0x0D, 0xB8, 0xF6, 0xB4, 0xED, 0xE3, 0x92, 0x41, 0x86, 0xFF, 0xD9, 0xB8, 0xC7, 0x73, 0x57,
			0x89, 0xC2, 0x3A, 0x36, 0xBA, 0x0B, 0x8A, 0xF6, 0x53, 0x72, 0xEB, 0x57, 0xEA, 0x5D, 0x89, 0xE7,
			0xD1, 0x4E, 0x9C, 0x7B, 0x6B, 0x55, 0x74, 0x60, 0xF1, 0x08, 0x85, 0xDA, 0x16, 0xAC, 0x92, 0x3F,
			0x15, 0xAF, 0x37, 0x58, 0xF0, 0xF0, 0x3E, 0xBD, 0x3C, 0x5C, 0x2C, 0x94, 0x9C, 0xBA, 0x30, 0x6D,
			0xB4, 0x4E, 0x6A, 0x2C, 0x07, 0x6C, 0x5F, 0x67, 0xE2, 0x81, 0xD7, 0xEF, 0x56, 0x78, 0x5D, 0xC4,
			0xD7, 0x59, 0x45, 0xE4, 0x91, 0xF0, 0x19, 0x18, 0x80, 0x0A, 0x9E, 0x2D, 0xC6, 0x6F, 0x60, 0x08,
			0x05, 0x66, 0xCE, 0x0D, 0xAF, 0x8D, 0x17, 0xEA, 0xD4, 0x6A, 0xD8, 0xE3, 0x0A, 0x24, 0x7C, 0x9F};

	static const unsigned char caPublicKeyDefault[] = {
			0xD9, 0xFD, 0x6E, 0xD7, 0x5D, 0x51, 0xD0, 0xE3, 0x06, 0x64, 0xBD, 0x15, 0x70, 0x23, 0xEA, 0xA1,
			0xFF, 0xA8, 0x71, 0xE4, 0xDA, 0x65, 0x67, 0x2B, 0x86, 0x3D, 0x25, 0x5E, 0x81, 0xE1, 0x37, 0xA5,
			0x1D, 0xE4, 0xF7, 0x2B, 0xCC, 0x9E, 0x44, 0xAC, 0xE1, 0x21, 0x27, 0xF8, 0x7E, 0x26, 0x3D, 0x3A,
			0xF9, 0xDD, 0x9C, 0xF3, 0x5C, 0xA4, 0xA7, 0xB0, 0x1E, 0x90, 0x70, 0x00, 0xBA, 0x85, 0xD2, 0x49,
			0x54, 0xC2, 0xFC, 0xA3, 0x07, 0x48, 0x25, 0xDD, 0xD4, 0xC0, 0xC8, 0xF1, 0x86, 0xCB, 0x02, 0x0F,
			0x68, 0x3E, 0x02, 0xF2, 0xDE, 0xAD, 0x39, 0x69, 0x13, 0x3F, 0x06, 0xF7, 0x84, 0x51, 0x66, 0xAC,
			0xEB, 0x57, 0xCA, 0x0F, 0xC2, 0x60, 0x34, 0x45, 0x46, 0x98, 0x11, 0xD2, 0x93, 0xBF, 0xEF, 0xBA,
			0xFA, 0xB5, 0x76, 0x31, 0xB3, 0xDD, 0x91, 0xE7, 0x96, 0xBF, 0x85, 0x0A, 0x25, 0x01, 0x2F, 0x1A,
			0xE3, 0x8F, 0x05, 0xAA, 0x5C, 0x4D, 0x6D, 0x03, 0xB1, 0xDC, 0x2E, 0x56, 0x86, 0x12, 0x78, 0x59,
			0x38, 0xBB, 0xC9, 0xB3, 0xCD, 0x3A, 0x91, 0x0C, 0x1D, 0xA5, 0x5A, 0x5A, 0x92, 0x18, 0xAC, 0xE0,
			0xF7, 0xA2, 0x12, 0x87, 0x75, 0x26, 0x82, 0xF1, 0x58, 0x32, 0xA6, 0x78, 0xD6, 0xE1, 0xED, 0x0B };

	//// MASTERCARD
	static const unsigned char caPublicKey_MC_FE[] = {
			0xA6, 0x53, 0xEA, 0xC1, 0xC0, 0xF7, 0x86, 0xC8, 0x72, 0x4F, 0x73, 0x7F, 0x17, 0x29, 0x97, 0xD6,
			0x3D, 0x1C, 0x32, 0x51, 0xC4, 0x44, 0x02, 0x04, 0x9B, 0x86, 0x5B, 0xAE, 0x87, 0x7D, 0x0F, 0x39,
			0x8C, 0xBF, 0xBE, 0x8A, 0x60, 0x35, 0xE2, 0x4A, 0xFA, 0x08, 0x6B, 0xEF, 0xDE, 0x93, 0x51, 0xE5,
			0x4B, 0x95, 0x70, 0x8E, 0xE6, 0x72, 0xF0, 0x96, 0x8B, 0xCD, 0x50, 0xDC, 0xE4, 0x0F, 0x78, 0x33,
			0x22, 0xB2, 0xAB, 0xA0, 0x4E, 0xF1, 0x37, 0xEF, 0x18, 0xAB, 0xF0, 0x3C, 0x7D, 0xBC, 0x58, 0x13,
			0xAE, 0xAE, 0xF3, 0xAA, 0x77, 0x97, 0xBA, 0x15, 0xDF, 0x7D, 0x5B, 0xA1, 0xCB, 0xAF, 0x7F, 0xD5,
			0x20, 0xB5, 0xA4, 0x82, 0xD8, 0xD3, 0xFE, 0xE1, 0x05, 0x07, 0x78, 0x71, 0x11, 0x3E, 0x23, 0xA4,
			0x9A, 0xF3, 0x92, 0x65, 0x54, 0xA7, 0x0F, 0xE1, 0x0E, 0xD7, 0x28, 0xCF, 0x79, 0x3B, 0x62, 0xA1};

	static const unsigned char caPublicKey_MC_EF[] = {
			0xA1, 0x91, 0xCB, 0x87, 0x47, 0x3F, 0x29, 0x34, 0x9B, 0x5D, 0x60, 0xA8, 0x8B, 0x3E, 0xAE, 0xE0,
			0x97, 0x3A, 0xA6, 0xF1, 0xA0, 0x82, 0xF3, 0x58, 0xD8, 0x49, 0xFD, 0xDF, 0xF9, 0xC0, 0x91, 0xF8,
			0x99, 0xED, 0xA9, 0x79, 0x2C, 0xAF, 0x09, 0xEF, 0x28, 0xF5, 0xD2, 0x24, 0x04, 0xB8, 0x8A, 0x22,
			0x93, 0xEE, 0xBB, 0xC1, 0x94, 0x9C, 0x43, 0xBE, 0xA4, 0xD6, 0x0C, 0xFD, 0x87, 0x9A, 0x15, 0x39,
			0x54, 0x4E, 0x09, 0xE0, 0xF0, 0x9F, 0x60, 0xF0, 0x65, 0xB2, 0xBF, 0x2A, 0x13, 0xEC, 0xC7, 0x05,
			0xF3, 0xD4, 0x68, 0xB9, 0xD3, 0x3A, 0xE7, 0x7A, 0xD9, 0xD3, 0xF1, 0x9C, 0xA4, 0x0F, 0x23, 0xDC,
			0xF5, 0xEB, 0x7C, 0x04, 0xDC, 0x8F, 0x69, 0xEB, 0xA5, 0x65, 0xB1, 0xEB, 0xCB, 0x46, 0x86, 0xCD,
			0x27, 0x47, 0x85, 0x53, 0x0F, 0xF6, 0xF6, 0xE9, 0xEE, 0x43, 0xAA, 0x43, 0xFD, 0xB0, 0x2C, 0xE0,
			0x0D, 0xAE, 0xC1, 0x5C, 0x7B, 0x8F, 0xD6, 0xA9, 0xB3, 0x94, 0xBA, 0xBA, 0x41, 0x9D, 0x3F, 0x6D,
			0xC8, 0x5E, 0x16, 0x56, 0x9B, 0xE8, 0xE7, 0x69, 0x89, 0x68, 0x8E, 0xFE, 0xA2, 0xDF, 0x22, 0xFF,
			0x7D, 0x35, 0xC0, 0x43, 0x33, 0x8D, 0xEA, 0xA9, 0x82, 0xA0, 0x2B, 0x86, 0x6D, 0xE5, 0x32, 0x85,
			0x19, 0xEB, 0xBC, 0xD6, 0xF0, 0x3C, 0xDD, 0x68, 0x66, 0x73, 0x84, 0x7F, 0x84, 0xDB, 0x65, 0x1A,
			0xB8, 0x6C, 0x28, 0xCF, 0x14, 0x62, 0x56, 0x2C, 0x57, 0x7B, 0x85, 0x35, 0x64, 0xA2, 0x90, 0xC8,
			0x55, 0x6D, 0x81, 0x85, 0x31, 0x26, 0x8D, 0x25, 0xCC, 0x98, 0xA4, 0xCC, 0x6A, 0x0B, 0xDF, 0xFF,
			0xDA, 0x2D, 0xCC, 0xA3, 0xA9, 0x4C, 0x99, 0x85, 0x59, 0xE3, 0x07, 0xFD, 0xDF, 0x91, 0x50, 0x06,
			0xD9, 0xA9, 0x87, 0xB0, 0x7D, 0xDA, 0xEB, 0x3B};

	static const unsigned char caPublicKey_MC_F1[] = {
			0xA0, 0xDC, 0xF4, 0xBD, 0xE1, 0x9C, 0x35, 0x46, 0xB4, 0xB6, 0xF0, 0x41, 0x4D, 0x17, 0x4D, 0xDE,
			0x29, 0x4A, 0xAB, 0xBB, 0x82, 0x8C, 0x5A, 0x83, 0x4D, 0x73, 0xAA, 0xE2, 0x7C, 0x99, 0xB0, 0xB0,
			0x53, 0xA9, 0x02, 0x78, 0x00, 0x72, 0x39, 0xB6, 0x45, 0x9F, 0xF0, 0xBB, 0xCD, 0x7B, 0x4B, 0x9C,
			0x6C, 0x50, 0xAC, 0x02, 0xCE, 0x91, 0x36, 0x8D, 0xA1, 0xBD, 0x21, 0xAA, 0xEA, 0xDB, 0xC6, 0x53,
			0x47, 0x33, 0x7D, 0x89, 0xB6, 0x8F, 0x5C, 0x99, 0xA0, 0x9D, 0x05, 0xBE, 0x02, 0xDD, 0x1F, 0x8C,
			0x5B, 0xA2, 0x0E, 0x2F, 0x13, 0xFB, 0x2A, 0x27, 0xC4, 0x1D, 0x3F, 0x85, 0xCA, 0xD5, 0xCF, 0x66,
			0x68, 0xE7, 0x58, 0x51, 0xEC, 0x66, 0xED, 0xBF, 0x98, 0x85, 0x1F, 0xD4, 0xE4, 0x2C, 0x44, 0xC1,
			0xD5, 0x9F, 0x59, 0x84, 0x70, 0x3B, 0x27, 0xD5, 0xB9, 0xF2, 0x1B, 0x8F, 0xA0, 0xD9, 0x32, 0x79,
			0xFB, 0xBF, 0x69, 0xE0, 0x90, 0x64, 0x29, 0x09, 0xC9, 0xEA, 0x27, 0xF8, 0x98, 0x95, 0x95, 0x41,
			0xAA, 0x67, 0x57, 0xF5, 0xF6, 0x24, 0x10, 0x4F, 0x6E, 0x1D, 0x3A, 0x95, 0x32, 0xF2, 0xA6, 0xE5,
			0x15, 0x15, 0xAE, 0xAD, 0x1B, 0x43, 0xB3, 0xD7, 0x83, 0x50, 0x88, 0xA2, 0xFA, 0xFA, 0x7B, 0xE7};

	static const unsigned char caPublicKey_MC_06[] = {
			0xCB, 0x26, 0xFC, 0x83, 0x0B, 0x43, 0x78, 0x5B, 0x2B, 0xCE, 0x37, 0xC8, 0x1E, 0xD3, 0x34, 0x62,
			0x2F, 0x96, 0x22, 0xF4, 0xC8, 0x9A, 0xAE, 0x64, 0x10, 0x46, 0xB2, 0x35, 0x34, 0x33, 0x88, 0x3F,
			0x30, 0x7F, 0xB7, 0xC9, 0x74, 0x16, 0x2D, 0xA7, 0x2F, 0x7A, 0x4E, 0xC7, 0x5D, 0x9D, 0x65, 0x73,
			0x36, 0x86, 0x5B, 0x8D, 0x30, 0x23, 0xD3, 0xD6, 0x45, 0x66, 0x76, 0x25, 0xC9, 0xA0, 0x7A, 0x6B,
			0x7A, 0x13, 0x7C, 0xF0, 0xC6, 0x41, 0x98, 0xAE, 0x38, 0xFC, 0x23, 0x80, 0x06, 0xFB, 0x26, 0x03,
			0xF4, 0x1F, 0x4F, 0x3B, 0xB9, 0xDA, 0x13, 0x47, 0x27, 0x0F, 0x2F, 0x5D, 0x8C, 0x60, 0x6E, 0x42,
			0x09, 0x58, 0xC5, 0xF7, 0xD5, 0x0A, 0x71, 0xDE, 0x30, 0x14, 0x2F, 0x70, 0xDE, 0x46, 0x88, 0x89,
			0xB5, 0xE3, 0xA0, 0x86, 0x95, 0xB9, 0x38, 0xA5, 0x0F, 0xC9, 0x80, 0x39, 0x3A, 0x9C, 0xBC, 0xE4,
			0x4A, 0xD2, 0xD6, 0x4F, 0x63, 0x0B, 0xB3, 0x3A, 0xD3, 0xF5, 0xF5, 0xFD, 0x49, 0x5D, 0x31, 0xF3,
			0x78, 0x18, 0xC1, 0xD9, 0x40, 0x71, 0x34, 0x2E, 0x07, 0xF1, 0xBE, 0xC2, 0x19, 0x4F, 0x60, 0x35,
			0xBA, 0x5D, 0xED, 0x39, 0x36, 0x50, 0x0E, 0xB8, 0x2D, 0xFD, 0xA6, 0xE8, 0xAF, 0xB6, 0x55, 0xB1,
			0xEF, 0x3D, 0x0D, 0x7E, 0xBF, 0x86, 0xB6, 0x6D, 0xD9, 0xF2, 0x9F, 0x6B, 0x1D, 0x32, 0x4F, 0xE8,
			0xB2, 0x6C, 0xE3, 0x8A, 0xB2, 0x01, 0x3D, 0xD1, 0x3F, 0x61, 0x1E, 0x7A, 0x59, 0x4D, 0x67, 0x5C,
			0x44, 0x32, 0x35, 0x0E, 0xA2, 0x44, 0xCC, 0x34, 0xF3, 0x87, 0x3C, 0xBA, 0x06, 0x59, 0x29, 0x87,
			0xA1, 0xD7, 0xE8, 0x52, 0xAD, 0xC2, 0x2E, 0xF5, 0xA2, 0xEE, 0x28, 0x13, 0x20, 0x31, 0xE4, 0x8F,
			0x74, 0x03, 0x7E, 0x3B, 0x34, 0xAB, 0x74, 0x7F};

	static const unsigned char caPublicKey_MC_05[] = {
			0xB8, 0x04, 0x8A, 0xBC, 0x30, 0xC9, 0x0D, 0x97, 0x63, 0x36, 0x54, 0x3E, 0x3F, 0xD7, 0x09, 0x1C,
			0x8F, 0xE4, 0x80, 0x0D, 0xF8, 0x20, 0xED, 0x55, 0xE7, 0xE9, 0x48, 0x13, 0xED, 0x00, 0x55, 0x5B,
			0x57, 0x3F, 0xEC, 0xA3, 0xD8, 0x4A, 0xF6, 0x13, 0x1A, 0x65, 0x1D, 0x66, 0xCF, 0xF4, 0x28, 0x4F,
			0xB1, 0x3B, 0x63, 0x5E, 0xDD, 0x0E, 0xE4, 0x01, 0x76, 0xD8, 0xBF, 0x04, 0xB7, 0xFD, 0x1C, 0x7B,
			0xAC, 0xF9, 0xAC, 0x73, 0x27, 0xDF, 0xAA, 0x8A, 0xA7, 0x2D, 0x10, 0xDB, 0x3B, 0x8E, 0x70, 0xB2,
			0xDD, 0xD8, 0x11, 0xCB, 0x41, 0x96, 0x52, 0x5E, 0xA3, 0x86, 0xAC, 0xC3, 0x3C, 0x0D, 0x9D, 0x45,
			0x75, 0x91, 0x64, 0x69, 0xC4, 0xE4, 0xF5, 0x3E, 0x8E, 0x1C, 0x91, 0x2C, 0xC6, 0x18, 0xCB, 0x22,
			0xDD, 0xE7, 0xC3, 0x56, 0x8E, 0x90, 0x02, 0x2E, 0x6B, 0xBA, 0x77, 0x02, 0x02, 0xE4, 0x52, 0x2A,
			0x2D, 0xD6, 0x23, 0xD1, 0x80, 0xE2, 0x15, 0xBD, 0x1D, 0x15, 0x07, 0xFE, 0x3D, 0xC9, 0x0C, 0xA3,
			0x10, 0xD2, 0x7B, 0x3E, 0xFC, 0xCD, 0x8F, 0x83, 0xDE, 0x30, 0x52, 0xCA, 0xD1, 0xE4, 0x89, 0x38,
			0xC6, 0x8D, 0x09, 0x5A, 0xAC, 0x91, 0xB5, 0xF3, 0x7E, 0x28, 0xBB, 0x49, 0xEC, 0x7E, 0xD5, 0x97};

	static const unsigned char caPublicKey_MC_04[] = {
			0xA6, 0xDA, 0x42, 0x83, 0x87, 0xA5, 0x02, 0xD7, 0xDD, 0xFB, 0x7A, 0x74, 0xD3, 0xF4, 0x12, 0xBE,
			0x76, 0x26, 0x27, 0x19, 0x7B, 0x25, 0x43, 0x5B, 0x7A, 0x81, 0x71, 0x6A, 0x70, 0x01, 0x57, 0xDD,
			0xD0, 0x6F, 0x7C, 0xC9, 0x9D, 0x6C, 0xA2, 0x8C, 0x24, 0x70, 0x52, 0x7E, 0x2C, 0x03, 0x61, 0x6B,
			0x9C, 0x59, 0x21, 0x73, 0x57, 0xC2, 0x67, 0x4F, 0x58, 0x3B, 0x3B, 0xA5, 0xC7, 0xDC, 0xF2, 0x83,
			0x86, 0x92, 0xD0, 0x23, 0xE3, 0x56, 0x24, 0x20, 0xB4, 0x61, 0x5C, 0x43, 0x9C, 0xA9, 0x7C, 0x44,
			0xDC, 0x9A, 0x24, 0x9C, 0xFC, 0xE7, 0xB3, 0xBF, 0xB2, 0x2F, 0x68, 0x22, 0x8C, 0x3A, 0xF1, 0x33,
			0x29, 0xAA, 0x4A, 0x61, 0x3C, 0xF8, 0xDD, 0x85, 0x35, 0x02, 0x37, 0x3D, 0x62, 0xE4, 0x9A, 0xB2,
			0x56, 0xD2, 0xBC, 0x17, 0x12, 0x0E, 0x54, 0xAE, 0xDC, 0xED, 0x6D, 0x96, 0xA4, 0x28, 0x7A, 0xCC,
			0x5C, 0x04, 0x67, 0x7D, 0x4A, 0x5A, 0x32, 0x0D, 0xB8, 0xBE, 0xE2, 0xF7, 0x75, 0xE5, 0xFE, 0xC5};


	static const unsigned char caPublicKey_UPI_01[] = {
			0xBB, 0xE9, 0x06, 0x6D, 0x25, 0x17, 0x51, 0x1D, 0x23, 0x9C, 0x7B, 0xFA, 0x77, 0x88, 0x41, 0x44,
			0xAE, 0x20, 0xC7, 0x37, 0x2F, 0x51, 0x51, 0x47, 0xE8, 0xCE, 0x65, 0x37, 0xC5, 0x4C, 0x0A, 0x6A,
			0x4D, 0x45, 0xF8, 0xCA, 0x4D, 0x29, 0x08, 0x70, 0xCD, 0xA5, 0x9F, 0x13, 0x44, 0xEF, 0x71, 0xD1,
			0x7D, 0x3F, 0x35, 0xD9, 0x2F, 0x3F, 0x06, 0x77, 0x8D, 0x0D, 0x51, 0x1E, 0xC2, 0xA7, 0xDC, 0x4F,
			0xFE, 0xAD, 0xF4, 0xFB, 0x12, 0x53, 0xCE, 0x37, 0xA7, 0xB2, 0xB5, 0xA3, 0x74, 0x12, 0x27, 0xBE,
			0xF7, 0x25, 0x24, 0xDA, 0x7A, 0x2B, 0x7B, 0x1C, 0xB4, 0x26, 0xBE, 0xE2, 0x7B, 0xC5, 0x13, 0xB0,
			0xCB, 0x11, 0xAB, 0x99, 0xBC, 0x1B, 0xC6, 0x1D, 0xF5, 0xAC, 0x6C, 0xC4, 0xD8, 0x31, 0xD0, 0x84,
			0x87, 0x88, 0xCD, 0x74, 0xF6, 0xD5, 0x43, 0xAD, 0x37, 0xC5, 0xA2, 0xB4, 0xC5, 0xD5, 0xA9, 0x3B
	};

	static const unsigned char caPublicKey_UPI_02[] = {
			0xA3, 0x76, 0x7A, 0xBD, 0x1B, 0x6A, 0xA6, 0x9D, 0x7F, 0x3F, 0xBF, 0x28, 0xC0, 0x92, 0xDE, 0x9E,
			0xD1, 0xE6, 0x58, 0xBA, 0x5F, 0x09, 0x09, 0xAF, 0x7A, 0x1C, 0xCD, 0x90, 0x73, 0x73, 0xB7, 0x21,
			0x0F, 0xDE, 0xB1, 0x62, 0x87, 0xBA, 0x8E, 0x78, 0xE1, 0x52, 0x9F, 0x44, 0x39, 0x76, 0xFD, 0x27,
			0xF9, 0x91, 0xEC, 0x67, 0xD9, 0x5E, 0x5F, 0x4E, 0x96, 0xB1, 0x27, 0xCA, 0xB2, 0x39, 0x6A, 0x94,
			0xD6, 0xE4, 0x5C, 0xDA, 0x44, 0xCA, 0x4C, 0x48, 0x67, 0x57, 0x0D, 0x6B, 0x07, 0x54, 0x2F, 0x8D,
			0x4B, 0xF9, 0xFF, 0x97, 0x97, 0x5D, 0xB9, 0x89, 0x15, 0x15, 0xE6, 0x6F, 0x52, 0x5D, 0x2B, 0x3C,
			0xBE, 0xB6, 0xD6, 0x62, 0xBF, 0xB6, 0xC3, 0xF3, 0x38, 0xE9, 0x3B, 0x02, 0x14, 0x2B, 0xFC, 0x44,
			0x17, 0x3A, 0x37, 0x64, 0xC5, 0x6A, 0xAD, 0xD2, 0x02, 0x07, 0x5B, 0x26, 0xDC, 0x2F, 0x9F, 0x7D,
			0x7A, 0xE7, 0x4B, 0xD7, 0xD0, 0x0F, 0xD0, 0x5E, 0xE4, 0x30, 0x03, 0x26, 0x63, 0xD2, 0x7A, 0x57
	};

	static const unsigned char caPublicKey_UPI_03[] = {
			0xB0, 0x62, 0x7D, 0xEE, 0x87, 0x86, 0x4F, 0x9C, 0x18, 0xC1, 0x3B, 0x9A, 0x1F, 0x02, 0x54, 0x48,
			0xBF, 0x13, 0xC5, 0x83, 0x80, 0xC9, 0x1F, 0x4C, 0xEB, 0xA9, 0xF9, 0xBC, 0xB2, 0x14, 0xFF, 0x84,
			0x14, 0xE9, 0xB5, 0x9D, 0x6A, 0xBA, 0x10, 0xF9, 0x41, 0xC7, 0x33, 0x17, 0x68, 0xF4, 0x7B, 0x21,
			0x27, 0x90, 0x7D, 0x85, 0x7F, 0xA3, 0x9A, 0xAF, 0x8C, 0xE0, 0x20, 0x45, 0xDD, 0x01, 0x61, 0x9D,
			0x68, 0x9E, 0xE7, 0x31, 0xC5, 0x51, 0x15, 0x9B, 0xE7, 0xEB, 0x2D, 0x51, 0xA3, 0x72, 0xFF, 0x56,
			0xB5, 0x56, 0xE5, 0xCB, 0x2F, 0xDE, 0x36, 0xE2, 0x30, 0x73, 0xA4, 0x4C, 0xA2, 0x15, 0xD6, 0xC2,
			0x6C, 0xA6, 0x88, 0x47, 0xB3, 0x88, 0xE3, 0x95, 0x20, 0xE0, 0x02, 0x6E, 0x62, 0x29, 0x4B, 0x55,
			0x7D, 0x64, 0x70, 0x44, 0x0C, 0xA0, 0xAE, 0xFC, 0x94, 0x38, 0xC9, 0x23, 0xAE, 0xC9, 0xB2, 0x09,
			0x8D, 0x6D, 0x3A, 0x1A, 0xF5, 0xE8, 0xB1, 0xDE, 0x36, 0xF4, 0xB5, 0x30, 0x40, 0x10, 0x9D, 0x89,
			0xB7, 0x7C, 0xAF, 0xAF, 0x70, 0xC2, 0x6C, 0x60, 0x1A, 0xBD, 0xF5, 0x9E, 0xEC, 0x0F, 0xDC, 0x8A,
			0x99, 0x08, 0x91, 0x40, 0xCD, 0x2E, 0x81, 0x7E, 0x33, 0x51, 0x75, 0xB0, 0x3B, 0x7A, 0xA3, 0x3D
	};

	static const unsigned char caPublicKey_UPI_04[] = {
			0xBC, 0x85, 0x3E, 0x6B, 0x53, 0x65, 0xE8, 0x9E, 0x7E, 0xE9, 0x31, 0x7C, 0x94, 0xB0, 0x2D, 0x0A,
			0xBB, 0x0D, 0xBD, 0x91, 0xC0, 0x5A, 0x22, 0x4A, 0x25, 0x54, 0xAA, 0x29, 0xED, 0x9F, 0xCB, 0x9D,
			0x86, 0xEB, 0x9C, 0xCB, 0xB3, 0x22, 0xA5, 0x78, 0x11, 0xF8, 0x61, 0x88, 0xAA, 0xC7, 0x35, 0x1C,
			0x72, 0xBD, 0x9E, 0xF1, 0x96, 0xC5, 0xA0, 0x1A, 0xCE, 0xF7, 0xA4, 0xEB, 0x0D, 0x2A, 0xD6, 0x3D,
			0x9E, 0x6A, 0xC2, 0xE7, 0x83, 0x65, 0x47, 0xCB, 0x15, 0x95, 0xC6, 0x8B, 0xCB, 0xAF, 0xD0, 0xF6,
			0x72, 0x87, 0x60, 0xF3, 0xA7, 0xCA, 0x7B, 0x97, 0x30, 0x1B, 0x7E, 0x02, 0x20, 0x18, 0x4E, 0xFC,
			0x4F, 0x65, 0x30, 0x08, 0xD9, 0x3C, 0xE0, 0x98, 0xC0, 0xD9, 0x3B, 0x45, 0x20, 0x10, 0x96, 0xD1,
			0xAD, 0xFF, 0x4C, 0xF1, 0xF9, 0xFC, 0x02, 0xAF, 0x75, 0x9D, 0xA2, 0x7C, 0xD6, 0xDF, 0xD6, 0xD7,
			0x89, 0xB0, 0x99, 0xF1, 0x6F, 0x37, 0x8B, 0x61, 0x00, 0x33, 0x4E, 0x63, 0xF3, 0xD3, 0x5F, 0x32,
			0x51, 0xA5, 0xEC, 0x78, 0x69, 0x37, 0x31, 0xF5, 0x23, 0x35, 0x19, 0xCD, 0xB3, 0x80, 0xF5, 0xAB,
			0x8C, 0x0F, 0x02, 0x72, 0x8E, 0x91, 0xD4, 0x69, 0xAB, 0xD0, 0xEA, 0xE0, 0xD9, 0x3B, 0x1C, 0xC6,
			0x6C, 0xE1, 0x27, 0xB2, 0x9C, 0x7D, 0x77, 0x44, 0x1A, 0x49, 0xD0, 0x9F, 0xCA, 0x5D, 0x6D, 0x97,
			0x62, 0xFC, 0x74, 0xC3, 0x1B, 0xB5, 0x06, 0xC8, 0xBA, 0xE3, 0xC7, 0x9A, 0xD6, 0xC2, 0x57, 0x87,
			0x75, 0xB9, 0x59, 0x56, 0xB5, 0x37, 0x0D, 0x1D, 0x05, 0x19, 0xE3, 0x79, 0x06, 0xB3, 0x84, 0x73,
			0x62, 0x33, 0x25, 0x1E, 0x8F, 0x09, 0xAD, 0x79, 0xDF, 0xBE, 0x2C, 0x6A, 0xBF, 0xAD, 0xAC, 0x8E,
			0x4D, 0x86, 0x24, 0x31, 0x8C, 0x27, 0xDA, 0xF1
	};

	static const unsigned char caPublicKey_UPI_08[] = {
			0xB6, 0x16, 0x45, 0xED, 0xFD, 0x54, 0x98, 0xFB, 0x24, 0x64, 0x44, 0x03, 0x7A, 0x0F, 0xA1, 0x8C,
			0x0F, 0x10, 0x1E, 0xBD, 0x8E, 0xFA, 0x54, 0x57, 0x3C, 0xE6, 0xE6, 0xA7, 0xFB, 0xF6, 0x3E, 0xD2,
			0x1D, 0x66, 0x34, 0x08, 0x52, 0xB0, 0x21, 0x1C, 0xF5, 0xEE, 0xF6, 0xA1, 0xCD, 0x98, 0x9F, 0x66,
			0xAF, 0x21, 0xA8, 0xEB, 0x19, 0xDB, 0xD8, 0xDB, 0xC3, 0x70, 0x6D, 0x13, 0x53, 0x63, 0xA0, 0xD6,
			0x83, 0xD0, 0x46, 0x30, 0x4F, 0x5A, 0x83, 0x6B, 0xC1, 0xBC, 0x63, 0x28, 0x21, 0xAF, 0xE7, 0xA2,
			0xF7, 0x5D, 0xA3, 0xC5, 0x0A, 0xC7, 0x4C, 0x54, 0x5A, 0x75, 0x45, 0x62, 0x20, 0x41, 0x37, 0x16,
			0x96, 0x63, 0xCF, 0xCC, 0x0B, 0x06, 0xE6, 0x7E, 0x21, 0x09, 0xEB, 0xA4, 0x1B, 0xC6, 0x7F, 0xF2,
			0x0C, 0xC8, 0xAC, 0x80, 0xD7, 0xB6, 0xEE, 0x1A, 0x95, 0x46, 0x5B, 0x3B, 0x26, 0x57, 0x53, 0x3E,
			0xA5, 0x6D, 0x92, 0xD5, 0x39, 0xE5, 0x06, 0x43, 0x60, 0xEA, 0x48, 0x50, 0xFE, 0xD2, 0xD1, 0xBF
	};

	static const unsigned char caPublicKey_UPI_09[] = {
			0xEB, 0x37, 0x4D, 0xFC, 0x5A, 0x96, 0xB7, 0x1D, 0x28, 0x63, 0x87, 0x5E, 0xDA, 0x2E, 0xAF, 0xB9,
			0x6B, 0x1B, 0x43, 0x9D, 0x3E, 0xCE, 0x0B, 0x18, 0x26, 0xA2, 0x67, 0x2E, 0xEE, 0xFA, 0x79, 0x90,
			0x28, 0x67, 0x76, 0xF8, 0xBD, 0x98, 0x9A, 0x15, 0x14, 0x1A, 0x75, 0xC3, 0x84, 0xDF, 0xC1, 0x4F,
			0xEF, 0x92, 0x43, 0xAA, 0xB3, 0x27, 0x07, 0x65, 0x9B, 0xE9, 0xE4, 0x79, 0x7A, 0x24, 0x7C, 0x2F,
			0x0B, 0x6D, 0x99, 0x37, 0x2F, 0x38, 0x4A, 0xF6, 0x2F, 0xE2, 0x3B, 0xC5, 0x4B, 0xCD, 0xC5, 0x7A,
			0x9A, 0xCD, 0x1D, 0x55, 0x85, 0xC3, 0x03, 0xF2, 0x01, 0xEF, 0x4E, 0x8B, 0x80, 0x6A, 0xFB, 0x80,
			0x9D, 0xB1, 0xA3, 0xDB, 0x1C, 0xD1, 0x12, 0xAC, 0x88, 0x4F, 0x16, 0x4A, 0x67, 0xB9, 0x9C, 0x7D,
			0x6E, 0x5A, 0x8A, 0x6D, 0xF1, 0xD3, 0xCA, 0xE6, 0xD7, 0xED, 0x3D, 0x5B, 0xE7, 0x25, 0xB2, 0xDE,
			0x4A, 0xDE, 0x23, 0xFA, 0x67, 0x9B, 0xF4, 0xEB, 0x15, 0xA9, 0x3D, 0x8A, 0x6E, 0x29, 0xC7, 0xFF,
			0xA1, 0xA7, 0x0D, 0xE2, 0xE5, 0x4F, 0x59, 0x3D, 0x90, 0x8A, 0x3B, 0xF9, 0xEB, 0xBD, 0x76, 0x0B,
			0xBF, 0xDC, 0x8D, 0xB8, 0xB5, 0x44, 0x97, 0xE6, 0xC5, 0xBE, 0x0E, 0x4A, 0x4D, 0xAC, 0x29, 0xE5
	};

	static const unsigned char caPublicKey_UPI_0A[] = {
			0xB2, 0xAB, 0x1B, 0x6E, 0x9A, 0xC5, 0x5A, 0x75, 0xAD, 0xFD, 0x5B, 0xBC, 0x34, 0x49, 0x0E, 0x53,
			0xC4, 0xC3, 0x38, 0x1F, 0x34, 0xE6, 0x0E, 0x7F, 0xAC, 0x21, 0xCC, 0x2B, 0x26, 0xDD, 0x34, 0x46,
			0x2B, 0x64, 0xA6, 0xFA, 0xE2, 0x49, 0x5E, 0xD1, 0xDD, 0x38, 0x3B, 0x81, 0x38, 0xBE, 0xA1, 0x00,
			0xFF, 0x9B, 0x7A, 0x11, 0x18, 0x17, 0xE7, 0xB9, 0x86, 0x9A, 0x97, 0x42, 0xB1, 0x9E, 0x5C, 0x9D,
			0xAC, 0x56, 0xF8, 0xB8, 0x82, 0x7F, 0x11, 0xB0, 0x5A, 0x08, 0xEC, 0xCF, 0x9E, 0x8D, 0x5E, 0x85,
			0xB0, 0xF7, 0xCF, 0xA6, 0x44, 0xEF, 0xF3, 0xE9, 0xB7, 0x96, 0x68, 0x8F, 0x38, 0xE0, 0x06, 0xDE,
			0xB2, 0x1E, 0x10, 0x1C, 0x01, 0x02, 0x89, 0x03, 0xA0, 0x60, 0x23, 0xAC, 0x5A, 0xAB, 0x86, 0x35,
			0xF8, 0xE3, 0x07, 0xA5, 0x3A, 0xC7, 0x42, 0xBD, 0xCE, 0x6A, 0x28, 0x3F, 0x58, 0x5F, 0x48, 0xEF
	};

	static const unsigned char caPublicKey_UPI_0B[] = {
			0xCF, 0x9F, 0xDF, 0x46, 0xB3, 0x56, 0x37, 0x8E, 0x9A, 0xF3, 0x11, 0xB0, 0xF9, 0x81, 0xB2, 0x1A,
			0x1F, 0x22, 0xF2, 0x50, 0xFB, 0x11, 0xF5, 0x5C, 0x95, 0x87, 0x09, 0xE3, 0xC7, 0x24, 0x19, 0x18,
			0x29, 0x34, 0x83, 0x28, 0x9E, 0xAE, 0x68, 0x8A, 0x09, 0x4C, 0x02, 0xC3, 0x44, 0xE2, 0x99, 0x9F,
			0x31, 0x5A, 0x72, 0x84, 0x1F, 0x48, 0x9E, 0x24, 0xB1, 0xBA, 0x00, 0x56, 0xCF, 0xAB, 0x3B, 0x47,
			0x9D, 0x0E, 0x82, 0x64, 0x52, 0x37, 0x5D, 0xCD, 0xBB, 0x67, 0xE9, 0x7E, 0xC2, 0xAA, 0x66, 0xF4,
			0x60, 0x1D, 0x77, 0x4F, 0xEA, 0xEF, 0x77, 0x5A, 0xCC, 0xC6, 0x21, 0xBF, 0xEB, 0x65, 0xFB, 0x00,
			0x53, 0xFC, 0x5F, 0x39, 0x2A, 0xA5, 0xE1, 0xD4, 0xC4, 0x1A, 0x4D, 0xE9, 0xFF, 0xDF, 0xDF, 0x13,
			0x27, 0xC4, 0xBB, 0x87, 0x4F, 0x1F, 0x63, 0xA5, 0x99, 0xEE, 0x39, 0x02, 0xFE, 0x95, 0xE7, 0x29,
			0xFD, 0x78, 0xD4, 0x23, 0x4D, 0xC7, 0xE6, 0xCF, 0x1A, 0xBA, 0xBA, 0xA3, 0xF6, 0xDB, 0x29, 0xB7,
			0xF0, 0x5D, 0x1D, 0x90, 0x1D, 0x2E, 0x76, 0xA6, 0x06, 0xA8, 0xCB, 0xFF, 0xFF, 0xEC, 0xBD, 0x91,
			0x8F, 0xA2, 0xD2, 0x78, 0xBD, 0xB4, 0x3B, 0x04, 0x34, 0xF5, 0xD4, 0x51, 0x34, 0xBE, 0x1C, 0x27,
			0x81, 0xD1, 0x57, 0xD5, 0x01, 0xFF, 0x43, 0xE5, 0xF1, 0xC4, 0x70, 0x96, 0x7C, 0xD5, 0x7C, 0xE5,
			0x3B, 0x64, 0xD8, 0x29, 0x74, 0xC8, 0x27, 0x59, 0x37, 0xC5, 0xD8, 0x50, 0x2A, 0x12, 0x52, 0xA8,
			0xA5, 0xD6, 0x08, 0x8A, 0x25, 0x9B, 0x69, 0x4F, 0x98, 0x64, 0x8D, 0x9A, 0xF2, 0xCB, 0x0E, 0xFD,
			0x9D, 0x94, 0x3C, 0x69, 0xF8, 0x96, 0xD4, 0x9F, 0xA3, 0x97, 0x02, 0x16, 0x2A, 0xCB, 0x5A, 0xF2,
			0x9B, 0x90, 0xBA, 0xDE, 0x00, 0x5B, 0xC1, 0x57
	};

	static const unsigned char revocListRid[] = { 0xA0, 0x00, 0x00, 0x00, 0x04 };
	static const unsigned char revocListIndex[] = { 0x01 };
	static const unsigned char revocListSerial_01[] = { 0x01, 0x02, 0x03 };
	static const unsigned char revocListSerial_02[] = { 0x04, 0x05, 0x06 };
	char TempData[128];

	TLV_TREE_NODE nodePan;
	TLV_TREE_NODE nodeCardHolder;
	TLV_TREE_NODE nodePanSeqNumber;
	TLV_TREE_NODE nodeAid;
	TLV_TREE_NODE nodeCapkIndex;
	EPSTOOL_Data_t dataPan;
	EPSTOOL_Data_t dataCardHolder;
	EPSTOOL_Data_t dataPanSeqNumber;
	EPSTOOL_Data_t dataAid;
	EPSTOOL_Data_t dataCaPublicKeyIndex;
	TLV_TREE_NODE nodeRevocationList;
	TLV_TREE_NODE nodeRevocationRid;
	TLV_TREE_NODE nodeRevocationIndex;
	card KeyIndex=0;
	char emvRespCode[4];
	byte bindata[2];
	char Hex_AID_Val[lenAID + 1];
	char Hex_PanSeqNum_Val[lenAID + 1];

	ASSERT(inputTlvTree != NULL);
	ASSERT(outputTlvTree != NULL);

	memset(bindata, 0, sizeof(bindata));
	memset(emvRespCode, 0, sizeof(emvRespCode));
	memset(Hex_AID_Val, 0, sizeof(Hex_AID_Val));
	memset(Hex_PanSeqNum_Val, 0, sizeof(Hex_PanSeqNum_Val));

	// TODO: Customise if required (terminate if refund...)

	// Retrieve the PAN, the PAN Sequence Counter, the AID and the CA Public Key Index
	if (inputTlvTree != NULL) {
		nodePan = EPSTOOL_TlvTree_FindFirstData(inputTlvTree, TAG_EMV_APPLI_PAN, &dataPan);
		nodeCardHolder = EPSTOOL_TlvTree_FindFirstData(inputTlvTree, TAG_EMV_CARDHOLDER_NAME, &dataCardHolder);
		nodePanSeqNumber = EPSTOOL_TlvTree_FindFirstData(inputTlvTree, TAG_EMV_APPLI_PAN_SEQUENCE_NUMBER, &dataPanSeqNumber);

		if(nodePanSeqNumber != NULL) {
			Hex_PanSeqNum_Val[0] = '\x01';
			strcpy(&Hex_PanSeqNum_Val[1], (char *)dataPanSeqNumber.value);
			mapPut(emvPANSeq, Hex_PanSeqNum_Val, (dataPanSeqNumber.length + 1));

			memset(TempData, 0,sizeof(TempData));
			bin2hex(TempData, dataPanSeqNumber.value, dataPanSeqNumber.length);
			mapPut(traCrdSeq, TempData, (dataPanSeqNumber.length * 2));// 5F34 PAN sequence number
		}
		nodeAid = EPSTOOL_TlvTree_FindFirstData(inputTlvTree, TAG_EMV_AID_TERMINAL, &dataAid);

		nodeCapkIndex = EPSTOOL_TlvTree_FindFirstData(inputTlvTree, TAG_EMV_CA_PUBLIC_KEY_INDEX_CARD, &dataCaPublicKeyIndex);

		// Get the CA Public Key
		if ((nodeAid != NULL) && (nodeCapkIndex != NULL) && (dataAid.length >= 5) && (dataAid.value != NULL) && (dataCaPublicKeyIndex.length == 1) && (dataCaPublicKeyIndex.value != NULL)) {
			// Get the CA Public Key index
			bin2hex(Hex_AID_Val,dataAid.value, dataAid.length);
			bin2num(&KeyIndex,dataCaPublicKeyIndex.value,1);

			if (strncmp(Hex_AID_Val, "A000000003", 10) == 0) { ///VISA

				mapPut(appCardName, "VISA", 0);
				switch(KeyIndex){
				case 5:	    //0x05
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey05, sizeof(caPublicKey05)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 7:	    //0x07
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey07, sizeof(caPublicKey07)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 8:  	//0x08
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey08, sizeof(caPublicKey08)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 9:  	//0x09
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey09, sizeof(caPublicKey09)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 146:	//0x92
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey, sizeof(caPublicKey)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 148:	//0x94
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey94, sizeof(caPublicKey94)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 149:	//0x95
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey95, sizeof(caPublicKey95)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
					//// UNKNOWN INDEX
				default:
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKeyDefault, sizeof(caPublicKeyDefault)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				}

			} else if (strncmp(Hex_AID_Val, "A000000004", 10) == 0) { ///MASTER CARD

				mapPut(appCardName, "MASTERCARD", 0);
				mapPutCard(traCardKernel, DEFAULT_EP_KERNEL_PAYPASS); //for use to filter sequence number on request
				switch(KeyIndex){
				case 4:  	//0x04
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_MC_04, sizeof(caPublicKey_MC_04)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 5:  	//0x05
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_MC_05, sizeof(caPublicKey_MC_05)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 6:  	//0x06
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_MC_06, sizeof(caPublicKey_MC_06)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 241:  	//0xF1
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_MC_F1, sizeof(caPublicKey_MC_F1)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 239:	//0xEF
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_MC_EF, sizeof(caPublicKey_MC_EF)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 254:	//0xFE
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_MC_FE, sizeof(caPublicKey_MC_FE)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
					//// UNKNOWN INDEX
				default:
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKeyDefault, sizeof(caPublicKeyDefault)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				}

			} else if (strncmp(Hex_AID_Val, "A000000333", 10) == 0) { /// UPI / CUP CARD

				strncpy(emvRespCode, "Z3", 2);
				hex2bin(bindata, emvRespCode, 1);
				mapPut(emvRspCod, bindata, 1);
				VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_AUTHORISATION_RESPONSE_CODE, bindata, 1) != NULL);

				mapPutStr(appCardName, "UPI");
				mapPutCard(traCardKernel, DEFAULT_EP_KERNEL_QUICKPASS); //for use to filter sequence number on request
				switch(KeyIndex){
				case 1:  	//0x01
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_UPI_01, sizeof(caPublicKey_UPI_01)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 2:  	//0x02
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_UPI_02, sizeof(caPublicKey_UPI_02)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 3:  	//0x03
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_UPI_03, sizeof(caPublicKey_UPI_03)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 4:  	//0x04
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_UPI_04, sizeof(caPublicKey_UPI_04)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;

					//Production
				case 8:  	//0x08
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_UPI_08, sizeof(caPublicKey_UPI_08)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 9:  	//0x09
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_UPI_09, sizeof(caPublicKey_UPI_09)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 10:  	//0x0A
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_UPI_0A, sizeof(caPublicKey_UPI_0A)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				case 11:  	//0x0B
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKey_UPI_0B, sizeof(caPublicKey_UPI_0B)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
					//// UNKNOWN INDEX
				default:
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_MODULUS, &caPublicKeyDefault, sizeof(caPublicKeyDefault)) != NULL);
					VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CAPK_EXPONENT, &exponent, sizeof(exponent)) != NULL);
					break;
				}

			} else {

			}

		}

		// Get the PAN related data
		if ((nodePan != NULL) && (dataPan.length > 0) && (dataPan.value != NULL)) {
			memset(TempData, 0,sizeof(TempData));
			bin2hex(TempData, dataPan.value, dataPan.length);
			mapPut(traPan, TempData, (dataPan.length * 2));

			// TODO: Check if PAN is in the exception file
			VERIFY(TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_PAN_IN_EXCEPTION_FILE, inBlackList, sizeof(inBlackList)) != NULL);
		}

		// Get the CardHolderName related data
		if ((nodeCardHolder != NULL) && (dataCardHolder.length > 0) && (dataCardHolder.value != NULL)) {
			memset(TempData, 0,sizeof(TempData));
			bin2hex(TempData, dataPan.value, dataPan.length);
			mapPut(traTrk1, TempData, (dataPan.length * 2));
			mapPut(traCardHolderName, TempData, (dataPan.length * 2));
		}
	}

	// Add the certification revocation list
	nodeRevocationList = TlvTree_AddChild(outputTlvTree, TAG_EMV_INT_CERTIFICATE_REVOCATION_LIST, NULL, 0);
	if (nodeRevocationList != NULL) {
		/*
													 |
													LIST
										  --------------------------
										  /							\
										 RID						...
								 ---------------------------
								/					|		\
							Index1				  Index2	...
						   /	|				 /	  |
					Serial1	 Serial2 ...	Serial1	  Serial2 ...


		The same RID & index can be added several times, so application can set the TlvTree as:
								 |
								LIST
					   -----------------------
					  /		  |		  |		  \
					 RID	 RID	 RID	 ...
					  |		  |		  |
					Index	Index	Index
					  |		  |		  |
					Serial	Serial	Serial

		 */
		// First entry
		nodeRevocationRid =   TlvTree_AddChild(nodeRevocationList, TAG_EMV_INT_CERTIFICATE_REVOCATION_LIST_RID, revocListRid, sizeof(revocListRid));
		nodeRevocationIndex = TlvTree_AddChild(nodeRevocationRid, TAG_EMV_INT_CERTIFICATE_REVOCATION_LIST_INDEX, revocListIndex, sizeof(revocListIndex));
		VERIFY(TlvTree_AddChild(nodeRevocationIndex, TAG_EMV_INT_CERTIFICATE_REVOCATION_LIST_SERIAL_NB, revocListSerial_01, sizeof(revocListSerial_01)) != NULL);
		// Second entry
		VERIFY(TlvTree_AddChild(nodeRevocationIndex, TAG_EMV_INT_CERTIFICATE_REVOCATION_LIST_SERIAL_NB, revocListSerial_02, sizeof(revocListSerial_02)) != NULL);
	}
}

//! \brief Execute the init step of an EMV transaction.
//! \param[in] EMV_object The EMV transaction object to use.
//! \param[in] inputTlvTree The input transaction data.
//! \param[out] tagsKernelToAppli If not \a NULL, the function creates a new TlvTree object and fill it
//! with the tags and values requested by the application.
//! If no tag is requested by the application or if the EMV kernel does not know any value of the requested tag,
//!  no TlvTree is created (so value is set to \a NULL).
//! \param[out] tagsRequestedByKernel If not \a NULL, the function creates a new TlvTree object and fill it
//! with the tags (with empty values) that the application shall provide to the next transaction step.
//! If no tag is requested by the EMV kernel, no TlvTree is created (so value is set to \a NULL).
//! \return  Can return any value of EMV_Status_t.
//! note The application is in charge to destroy the created TlvTree \a tagsKernelToAppli and \a tagsRequestedByKernel.
EMV_Status_t EMV_ServicesEmv_Init(EMV_Object_t EMV_object, TLV_TREE_NODE inputTlvTree, TLV_TREE_NODE *tagsKernelToAppli, TLV_TREE_NODE *tagsRequestedByKernel) {
	EMV_Status_t emvStatus;
	static const EPSTOOL_Tag_t tagsToGet[] = { TAG_EMV_INT_NEXT_STEP };

	// Call the EMV API to perform init
	emvStatus = EMV_ExecuteStep(EMV_object, EMV_STEP_INIT, inputTlvTree, sizeof(tagsToGet) / sizeof(tagsToGet[0]), tagsToGet, tagsKernelToAppli, tagsRequestedByKernel);

	return emvStatus;
}

//! \brief Execute the initiate application processing step of an EMV transaction.
//! \param[in] EMV_object The EMV transaction object to use.
//! \param[in] inputTlvTree The input transaction data.
//! \param[out] tagsKernelToAppli If not \a NULL, the function creates a new TlvTree object and fill it
//! with the tags and values requested by the application.
//! If no tag is requested by the application or if the EMV kernel does not know any value of the requested tag,
//!  no TlvTree is created (so value is set to \a NULL).
//! \param[out] tagsRequestedByKernel If not \a NULL, the function creates a new TlvTree object and fill it
//! with the tags (with empty values) that the application shall provide to the next transaction step.
//! If no tag is requested by the EMV kernel, no TlvTree is created (so value is set to \a NULL).
//! \return  Can return any value of EMV_Status_t.
//! note The application is in charge to destroy the created TlvTree \a tagsKernelToAppli and \a tagsRequestedByKernel.
EMV_Status_t EMV_ServicesEmv_InitiateApplicationSelection(EMV_Object_t EMV_object, TLV_TREE_NODE inputTlvTree, TLV_TREE_NODE *tagsKernelToAppli, TLV_TREE_NODE *tagsRequestedByKernel) {
	EMV_Status_t emvStatus;
	static const EPSTOOL_Tag_t tagsToGet[] = { TAG_EMV_INT_NEXT_STEP };

	// Ask for amount entry
	emvStatus = EMV_ServicesEmv_GetAmount(inputTlvTree);

	// Ask for account entry
	if (emvStatus == EMV_STATUS_SUCCESS) {
		emvStatus = EMV_ServicesEmv_MenuAccountType(inputTlvTree);

		if (emvStatus == EMV_STATUS_SUCCESS) {
			// Display message "Please wait"
			EMV_UI_MessagePleaseWait();

			// Call the EMV API to perform initiate application processing
			emvStatus = EMV_ExecuteStep(EMV_object, EMV_STEP_INITIATE_APPLICATION_PROCESSING, inputTlvTree, sizeof(tagsToGet) / sizeof(tagsToGet[0]), tagsToGet, tagsKernelToAppli, tagsRequestedByKernel);
		}
	}

	// TODO EMV_STATUS_SELECT_ANOTHER_AID

	return emvStatus;
}

//! \brief Execute the read records step of an EMV transaction.
//! \param[in] EMV_object The EMV transaction object to use.
//! \param[in] inputTlvTree The input transaction data.
//! \param[out] tagsKernelToAppli If not \a NULL, the function creates a new TlvTree object and fill it
//! with the tags and values requested by the application.
//! If no tag is requested by the application or if the EMV kernel does not know any value of the requested tag,
//!  no TlvTree is created (so value is set to \a NULL).
//! \param[out] tagsRequestedByKernel If not \a NULL, the function creates a new TlvTree object and fill it
//! with the tags (with empty values) that the application shall provide to the next transaction step.
//! If no tag is requested by the EMV kernel, no TlvTree is created (so value is set to \a NULL).
//! \return  Can return any value of EMV_Status_t.
//! note The application is in charge to destroy the created TlvTree \a tagsKernelToAppli and \a tagsRequestedByKernel.
EMV_Status_t EMV_ServicesEmv_ReadRecords(EMV_Object_t EMV_object, TLV_TREE_NODE inputTlvTree, TLV_TREE_NODE *tagsKernelToAppli, TLV_TREE_NODE *tagsRequestedByKernel) {
	EMV_Status_t emvStatus;
	static const EPSTOOL_Tag_t tagsToGet[] = { TAG_EMV_INT_NEXT_STEP, TAG_EMV_TRACK_2_EQU_DATA, TAG_EMV_APPLI_PAN_SEQUENCE_NUMBER, TAG_EMV_APPLI_PAN, TAG_EMV_AID_TERMINAL, TAG_EMV_CA_PUBLIC_KEY_INDEX_CARD , TAG_EMV_CARDHOLDER_NAME};

	// Call the EMV API to perform read records
	emvStatus = EMV_ExecuteStep(EMV_object, EMV_STEP_READ_APPLICATION_DATA, inputTlvTree, sizeof(tagsToGet) / sizeof(tagsToGet[0]), tagsToGet, tagsKernelToAppli, tagsRequestedByKernel);

	return emvStatus;
}

//! \brief Execute the offline data authentication step of an EMV transaction.
//! \param[in] EMV_object The EMV transaction object to use.
//! \param[in] inputTlvTree The input transaction data.
//! \param[out] tagsKernelToAppli If not \a NULL, the function creates a new TlvTree object and fill it
//! with the tags and values requested by the application.
//! If no tag is requested by the application or if the EMV kernel does not know any value of the requested tag,
//!  no TlvTree is created (so value is set to \a NULL).
//! \param[out] tagsRequestedByKernel If not \a NULL, the function creates a new TlvTree object and fill it
//! with the tags (with empty values) that the application shall provide to the next transaction step.
//! If no tag is requested by the EMV kernel, no TlvTree is created (so value is set to \a NULL).
//! \return  Can return any value of EMV_Status_t.
//! note The application is in charge to destroy the created TlvTree \a tagsKernelToAppli and \a tagsRequestedByKernel.
EMV_Status_t EMV_ServicesEmv_OfflineDataAuthentication(EMV_Object_t EMV_object, TLV_TREE_NODE inputTlvTree, TLV_TREE_NODE *tagsKernelToAppli, TLV_TREE_NODE *tagsRequestedByKernel) {
	EMV_Status_t emvStatus;
	static const EPSTOOL_Tag_t tagsToGet[] = { TAG_EMV_INT_NEXT_STEP };

	// Call the EMV API to perform offline data authentication s
	emvStatus = EMV_ExecuteStep(EMV_object, EMV_STEP_OFFLINE_DATA_AUTHENTICATION, inputTlvTree, sizeof(tagsToGet) / sizeof(tagsToGet[0]), tagsToGet, tagsKernelToAppli, tagsRequestedByKernel);

	return emvStatus;
}

//! \brief Execute the processing restriction step of an EMV transaction.
//! \param[in] EMV_object The EMV transaction object to use.
//! \param[in] inputTlvTree The input transaction data.
//! \param[out] tagsKernelToAppli If not \a NULL, the function creates a new TlvTree object and fill it
//! with the tags and values requested by the application.
//! If no tag is requested by the application or if the EMV kernel does not know any value of the requested tag,
//!  no TlvTree is created (so value is set to \a NULL).
//! \param[out] tagsRequestedByKernel If not \a NULL, the function creates a new TlvTree object and fill it
//! with the tags (with empty values) that the application shall provide to the next transaction step.
//! If no tag is requested by the EMV kernel, no TlvTree is created (so value is set to \a NULL).
//! \return  Can return any value of EMV_Status_t.
//! note The application is in charge to destroy the created TlvTree \a tagsKernelToAppli and \a tagsRequestedByKernel.
EMV_Status_t EMV_ServicesEmv_ProcessingRestriction(EMV_Object_t EMV_object, TLV_TREE_NODE inputTlvTree, TLV_TREE_NODE *tagsKernelToAppli, TLV_TREE_NODE *tagsRequestedByKernel) {
	EMV_Status_t emvStatus;
	static const EPSTOOL_Tag_t tagsToGet[] = { TAG_EMV_INT_NEXT_STEP };

	// Call the EMV API to perform processing restriction
	emvStatus = EMV_ExecuteStep(EMV_object, EMV_STEP_PROCESSING_RESTRICTION, inputTlvTree, sizeof(tagsToGet) / sizeof(tagsToGet[0]), tagsToGet, tagsKernelToAppli, tagsRequestedByKernel);

	return emvStatus;
}


